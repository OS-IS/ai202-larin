### Тестування на LDAP-ін'єкцію

ID  
WSTG-INPV-06

#### Підсумування

Протокол Lightweight Directory Access Protocol (LDAP) використовується для зберігання інформації про користувачів, хости та інші об'єкти. LDAP ін'єкція — це атака на серверному боці, яка може дозволити розкриття, зміну або вставку чутливої інформації про користувачів і хости, представлену в LDAP структурі, шляхом маніпулювання вхідними параметрами, які передаються на внутрішні функції пошуку, додавання та зміни.

Веб-додаток може використовувати LDAP для того, щоб дозволити користувачам аутентифікацію або пошук іншої інформації про користувачів у корпоративній структурі. Метою атак на LDAP ін'єкцію є введення метасимволів LDAP пошукового фільтра в запит, який буде виконано додатком.

RFC2254 визначає граматику для побудови пошукового фільтра в LDAPv3 та розширює RFC1960 (LDAPv2).

LDAP пошуковий фільтр будується за польською нотацією (також відомою як префіксна польська нотація).

#### Метасимволи LDAP

Метасимволи, що використовуються в пошукових фільтрах LDAP:

| Метасимвол | Значення         |
|------------|------------------|
| &          | Логічне AND      |
| \|         | Логічне OR       |
| !          | Логічне NOT      |
| =          | Рівність         |
| ~=         | Приблизно        |
| >=         | Більше або дорівнює |
| <=         | Менше або дорівнює |
| *          | Будь-який символ |
| ()         | Групування      |

#### Цілі тестування

- Виявлення точок LDAP ін'єкції.
- Оцінка серйозності ін'єкції.

#### Як тестувати

##### Приклад 1: Пошукові фільтри

Уявімо, що веб-додаток використовує такий пошуковий фільтр:

`searchfilter="(cn="+user+")"`

Якщо значення `user` замінити на `*`, відправивши запит:

`http://www.example.com/ldapsearch?user=*`

фільтр виглядатиме так:

`searchfilter="(cn=*)"`

Цей фільтр відповідає на кожен об'єкт, де атрибут 'cn' дорівнює будь-чому.

Якщо додаток вразливий до LDAP ін'єкції, він може відобразити деякі або всі атрибути користувача, залежно від виконання додатку та прав користувача LDAP.

##### Приклад 2: Аутентифікація

Якщо веб-додаток використовує LDAP для перевірки облікових даних користувача під час процесу входу, і він вразливий до LDAP ін'єкції, можна обійти перевірку аутентифікації, вставивши завжди правильний LDAP запит (подібно до SQL та XPATH ін'єкцій).

Уявімо, що веб-додаток використовує такий фільтр для співставлення пари користувач/пароль:

`searchlogin= "(&(uid="+user+")(userPassword={MD5}"+base64(pack("H*",md5(pass)))+"))";`

Якщо використовувати такі значення:

```
user=)(uid=))(|(uid=* 
pass=password
```


пошуковий фільтр виглядатиме так:

`searchlogin="(&(uid=*)(uid=*))(|(uid=*)(userPassword={MD5}X03MO1qnZdYdgyfeuILPmQ==))";`

що завжди правильно і істинно. Це дозволяє тестувальнику отримати статус увійшовшого користувача як першого в LDAP дереві.
